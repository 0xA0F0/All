let firebaseConfig={apiKey:"AIzaSyDQU1xjjIBFKferAQbVlSC2wxMG-Oa0y3M",authDomain:"pirate-1.firebaseapp.com",databaseURL:"https://pirate-1-default-rtdb.europe-west1.firebasedatabase.app",projectId:"pirate-1",storageBucket:"pirate-1.appspot.com",messagingSenderId:"859831291688",appId:"1:859831291688:web:f5d6e62ea9c268947eca1d",measurementId:"G-R02JJVTG9B"};import{initializeApp as e}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";import{getAnalytics as t}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-analytics.js";import{getDatabase as a,ref as s,push as n,onValue as m,remove as o}from"https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";let app=e(firebaseConfig),analytics=t(app),database=a(),commentForm=document.getElementById("commentForm"),commentInput=document.getElementById("commentInput"),commentsBlock=document.getElementById("commentsBlock"),loadMoreButton=document.createElement("span");loadMoreButton.textContent="Еще",loadMoreButton.classList.add("load-more-button"),commentsBlock.after(loadMoreButton);let comments=[],commentLimit=10;function displayComments(){commentsBlock.innerHTML="",comments.slice(0,commentLimit).forEach(e=>{let t=document.createElement("div");t.classList.add("comment");let a=document.createElement("img");a.src="/post/img/ava.webp",a.alt="pirate",t.appendChild(a);let s=document.createElement("span");s.textContent="Pirate",s.classList.add("nickname"),t.appendChild(s);let n=document.createElement("button");n.classList.add("delete","mdi","mdi-close"),n.addEventListener("click",()=>{deleteComment(e.key)}),t.appendChild(n);let m=document.createElement("div"),o=e.text.substring(0,400);if(m.innerHTML=parseCommentText(o),m.classList.add("cmt"),t.appendChild(m),e.text.length>400){let i=document.createElement("span");i.textContent="... Читать дальше",i.addEventListener("click",()=>{m.innerHTML=parseCommentText(e.text),i.style.display="none"}),i.classList.add("more-text"),m.appendChild(i)}commentsBlock.appendChild(t)}),commentLimit>=comments.length?loadMoreButton.style.display="none":loadMoreButton.style.display="inline"}function parseCommentText(e){return e=(e=(e=e.replace(/\[right\]([\s\S]*?)\[\/right\]/g,'<div class="right">$1</div>')).replace(/\[center\]([\s\S]*?)\[\/center\]/g,'<div class="center">$1</div>')).replace(/\[img=([^\s]+)\s+w=(\d+)\s+h=(\d+)\]/g,'<img src="$1" alt="img" style="width: $2px; height: $3px;">')}function deleteComment(e){let t=s(database,`comments/${e}`);o(t)}function sendComment(e){if(""!==e.text.trim()){let t=s(database,"comments");n(t,e)}else alert("Пожалуйста, введите комментарий.")}loadMoreButton.addEventListener("click",()=>{commentLimit+=10,displayComments()}),m(s(database,"comments"),e=>{comments=[],e.forEach(e=>{let t={key:e.key,text:e.val().text};comments.push(t)}),comments.reverse(),displayComments()}),commentForm.addEventListener("submit",e=>{e.preventDefault();let t=commentInput.value.trim();""!==t?(sendComment({text:t}),commentInput.value=""):alert("Пожалуйста, введите комментарий.")});
